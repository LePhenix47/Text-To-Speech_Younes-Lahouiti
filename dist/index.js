(()=>{"use strict";function e(e,t=document){if(t===document)return document.querySelector(e);switch(!0){case t.tagName?.includes("-"):return t.shadowRoot?.querySelector(e);case t instanceof HTMLTemplateElement:return document.importNode(t.content,!0).querySelector(e);case t instanceof HTMLIFrameElement:return t.contentDocument?.querySelector(e);default:return t.querySelector(e)}}function t(e,t,n=document.body){const o=t.toString();return n.style.setProperty(e,o)}var n;!function(e){e[e.rate=10]="rate",e[e.pitch=2]="pitch",e[e.volume=1]="volume"}(n||(n={}));const o=function(){function e(){}return e.setKey=function(e,t,n){void 0===n&&(n=!1);var o=JSON.stringify(t);(n?sessionStorage:localStorage).setItem(e,o)},e.getKey=function(e,t){void 0===t&&(t=!1);var n=(t?sessionStorage:localStorage).getItem(e);return n?this.isParseable(n)?JSON.parse(n):n:null},e.removeKey=function(e,t){void 0===t&&(t=!1),(t?sessionStorage:localStorage).removeItem(e)},e.clearAll=function(e){void 0===e&&(e=!1),e?sessionStorage.clear():localStorage.clear()},e.currentLength=function(e){return void 0===e&&(e=!1),(e?sessionStorage:localStorage).length},e.getKeyNameByIndex=function(e,t){return void 0===t&&(t=!1),(t?sessionStorage:localStorage).key(e)},e.replacer=function(e,t){return t instanceof Map?{__type:"Map",value:Object.fromEntries(t)}:t instanceof Set?{__type:"Set",value:Array.from(t)}:t},e.reviver=function(e,t){switch(null==t?void 0:t.__type){case"Set":return new Set(null==t?void 0:t.value);case"Map":return new Map(null==t?void 0:t.value);default:return t}},e.isParseable=function(e){try{return JSON.parse(e),!0}catch(e){return!1}},e}();const r=new(function(){function e(){var e=this;this.setVoiceRate=function(t){return e.utterance.rate=e.clamp(0,t,10),e},this.setVoicePitch=function(t){return e.utterance.pitch=e.clamp(0,t,3),e},this.setVolume=function(t){return e.utterance.volume=e.clamp(0,t,1),e},this.setLanguage=function(t){return e.utterance.lang=t,e},this.setVoiceSpeech=function(t){return e.utterance.voice=t,e},this.setVoiceText=function(t){return e.utterance.text=t,e},this.setOnVoicesChanged=function(t){return speechSynthesis.addEventListener("voiceschanged",(function(){t(e.getVoices())})),e},this.getVoices=function(e){var t=speechSynthesis.getVoices();return e?t.filter((function(t){return t.lang.includes(e)})):t},this.speak=function(){speechSynthesis.speak(e.utterance)},this.cancelSpeech=function(){speechSynthesis.cancel()},this.pauseSpeech=function(){speechSynthesis.pause()},this.resumeSpeech=function(){speechSynthesis.resume()},this.utterance=new SpeechSynthesisUtterance}return e.prototype.setOnBoundary=function(e){return this.utterance.onboundary=e,this},e.prototype.setOnEnd=function(e){return this.utterance.onend=e,this},e.prototype.setOnError=function(e){return this.utterance.onerror=e,this},e.prototype.setOnMark=function(e){return this.utterance.onmark=e,this},e.prototype.setOnPause=function(e){return this.utterance.onpause=e,this},e.prototype.setOnResume=function(e){return this.utterance.onresume=e,this},e.prototype.setOnStart=function(e){return this.utterance.onstart=e,this},Object.defineProperty(e.prototype,"isPaused",{get:function(){return speechSynthesis.paused},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSpeaking",{get:function(){return speechSynthesis.speaking},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPending",{get:function(){return speechSynthesis.pending},enumerable:!1,configurable:!0}),e.prototype.clamp=function(e,t,n){var o=Math.max(t,e);return Math.min(o,n)},e}());let c=0;const s=e("textarea"),i=e("select#voice-selection"),u=e("input#voice-rate"),a=e("output[name=voice-rate]"),l=e("input#voice-pitch"),p=e("output[name=voice-pitch]"),h=e("input#voice-volume"),f=e("output[name=voice-volume]"),g=e(".index__button--start"),d=e(".index__button--pause"),m=e(".index__button--stop"),y=[i,u,l,h,s],v=[null,a,p,f,null],S=new Map,b=new Map;function k(e){const{rate:c,pitch:s,text:i,volume:u}=o.getKey("text-to-speech-options");let a=null;switch(e.name){case"voice-selection":{const t=x(e.value);r.setVoiceSpeech(t);break}case"voice-rate":S.get(e).textContent=c.toString(),a=c/n.rate*100,t("--_webkit-progression-width",`${a}%`,e),r.setVoiceRate(c);break;case"voice-pitch":S.get(e).textContent=s.toString(),a=s/n.pitch*100,t("--_webkit-progression-width",`${a}%`,e),r.setVoicePitch(s);break;case"voice-volume":{const n=S.get(e);a=Math.round(100*u),n.textContent=`${a}%`,t("--_webkit-progression-width",`${a}%`,e),r.setVolume(u);break}case"text-to-read":a=i,r.setVoiceText(i);break;default:throw new Error("Unknown property to change")}r.setVoiceSpeech,console.log(e.name,{defaultValue:a}),e.value=a}function x(e){return b.get(navigator.language).find((t=>t.name===e))}function w(e){}function V(){console.log(r.utterance)}function O(){console.log("Starting speech");const{isPaused:e,isSpeaking:t}=r;if(e&&t)return r.resumeSpeech(),void V();e||!t?(r.speak(),V()):V()}function P(){console.log("Stopping speech"),r.resumeSpeech(),r.cancelSpeech(),V()}function _(){r.setVoiceText(s.value.substring(c)),console.log(s.value.substring(c))}function M(e){P();const{value:t,valueAsNumber:c}=e.target,a=o.getKey("text-to-speech-options");switch(e.target){case s:a.text=t;break;case i:{const e=x(t);r.setVoiceSpeech(e);break}case u:{const e=c*n.rate/100;a.rate=e,r.setVoiceRate(e);S.get(u).textContent=e.toString();break}case l:{const e=c*n.pitch/100;a.pitch=e,r.setVoicePitch(e);S.get(l).textContent=e.toString();break}case h:{const e=c*n.volume/100;r.setVolume(e);const o=S.get(h);a.volume=e,o.textContent=`${t}%`;break}}o.setKey("text-to-speech-options",a),_(),console.log(r.utterance.text),O()}!function(){for(let e=0;e<y.length;e++)S.set(y[e],v[e])}(),function(){if(o.getKey("text-to-speech-options"))return;o.setKey("text-to-speech-options",{pitch:1,rate:1,volume:1,text:""})}(),function(){const e=function(e,t=document){if(t===document)return Array.from(document.querySelectorAll(e));switch(!0){case t.tagName?.includes("-"):return Array.from(t.shadowRoot?.querySelectorAll(e)||[]);case t instanceof HTMLTemplateElement:return Array.from(document.importNode(t.content,!0).querySelectorAll(e));case t instanceof HTMLIFrameElement:return Array.from(t.contentDocument?.querySelectorAll(e)||[]);default:return Array.from(t.querySelectorAll(e))}}('input[type="range"][data-range="a-range-with-overflowing-thumb"]');for(const t of e)t.addEventListener("input",(e=>{const t=e.currentTarget,{max:n,valueAsNumber:o}=t,r=`${Math.round(o/Number(n)*100)}%`;t.style.setProperty("--_webkit-progression-width",r)}))}(),r.setOnVoicesChanged((()=>{!function(){const e=r.getVoices();let t="";for(const n of e){let e=b.get(n.lang);e||(e=[],b.set(n.lang,e)),e.push(n),t+=`\n    <option value="${n.name}">${n.name} _ ${n.lang}</option>\n    `}i.insertAdjacentHTML("beforeend",t)}(),function(){for(const e of y)k(e),e.addEventListener("change",w),e.addEventListener("input",M)}()})),r.setOnBoundary((e=>{c=e.charIndex})),g.addEventListener("click",(()=>{c=0,O()})),d.addEventListener("click",(()=>{c=0,function(){console.log("Pausing speech");const{isPaused:e,isSpeaking:t,isPending:n}=r;t&&(r.pauseSpeech(),V())}()})),m.addEventListener("click",(()=>{c=0,P(),_()}))})();